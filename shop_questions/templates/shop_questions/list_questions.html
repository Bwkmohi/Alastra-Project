{% extends 'shop_questions/base.html' %}

{% block shop_questions %}

<title>
    مدیریت سوالات
</title>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-5">

  <!-- کارت پاسخ‌ها -->
  <a href="{% url 's_ques:list_responses' shop_id %}" class="relative group bg-gradient-to-br from-[#062441] via-[#0b1421] to-[#0d4370] rounded-2xl shadow-2xl hover:scale-105 transition-all duration-300 p-6 flex flex-col items-center justify-center text-center">
    <i class="bi bi-reply-all-fill text-5xl text-[#b0ffd1] mb-3 transition-all duration-300 group-hover:text-[#ffffff]"></i>
    <p class="font-bold text-lg text-white group-hover:text-[#b0ffd1]">لیست پاسخ‌ها</p>
    <span class="absolute top-3 right-3 bg-[#0bffff44] text-[#0b1421] px-2 py-1 rounded-full text-xs font-bold">{{ count_shop_responses }}</span>
    <button class="mt-4 bg-[#0bffffcc] text-[#0b1421] font-bold px-4 py-2 rounded hover:bg-[#0bffffee] transition">مشاهده</button>
  </a>

  <!-- کارت کامنت‌ها -->
  <a href="{% url 's_ques:list_comments' shop_id %}" class="relative group bg-gradient-to-br from-[#0b1421] via-[#062441] to-[#0d4370] rounded-2xl shadow-2xl hover:scale-105 transition-all duration-300 p-6 flex flex-col items-center justify-center text-center">
    <i class="bi bi-chat-dots-fill text-5xl text-[#b0ffd1] mb-3 transition-all duration-300 group-hover:text-[#ffffff]"></i>
    <p class="font-bold text-lg text-white group-hover:text-[#b0ffd1]">لیست کامنت‌ها</p>
    <span class="absolute top-3 right-3 bg-[#0bffff44] text-[#0b1421] px-2 py-1 rounded-full text-xs font-bold">{{ count_shop_comments }}</span>
    <button class="mt-4 bg-[#0bffffcc] text-[#0b1421] font-bold px-4 py-2 rounded hover:bg-[#0bffffee] transition">مشاهده</button>
  </a>

  <!-- کارت سوالات -->
  <a href="{% url 's_ques:list_questions' shop_id %}" class="relative group bg-gradient-to-br from-[#062441] via-[#0b1421] to-[#0d4370] rounded-2xl shadow-2xl hover:scale-105 transition-all duration-300 p-6 flex flex-col items-center justify-center text-center">
    <i class="bi bi-question-circle-fill text-5xl text-[#b0ffd1] mb-3 transition-all duration-300 group-hover:text-[#ffffff]"></i>
    <p class="font-bold text-lg text-white group-hover:text-[#b0ffd1]">لیست سوالات</p>
    <span class="absolute top-3 right-3 bg-[#0bffff44] text-[#0b1421] px-2 py-1 rounded-full text-xs font-bold">{{ count_shop_questions }}</span>
    <button class="mt-4 bg-[#0bffffcc] text-[#0b1421] font-bold px-4 py-2 rounded hover:bg-[#0bffffee] transition">مشاهده</button>
  </a>

</div>


<br><br><br>


<form method="GET" action="" class="bg-gradient-to-r from-[#062441] via-[#0b1421] to-[#062441] border border-[#0bffffcc] p-4 rounded-2xl shadow-xl flex flex-col md:flex-row items-center gap-3">

  <!-- سرچ -->
  <div class="flex items-center w-full md:w-3/5 bg-[#0b1421] rounded-xl overflow-hidden shadow-md border border-[#0bffffcc]">
    <i class="bi bi-search text-[#b0bfd1] px-3"></i>
    <input 
      type="text" 
      name="search"
      placeholder="جستجو..." 
      class="w-full p-2 bg-transparent text-white placeholder-gray-400 outline-none"
    />
  </div>

  <!-- فیلتر -->
  <select 
    name="filter"
    class="w-full md:w-1/5 p-2 rounded-xl bg-[#0b1421] border border-[#0bffffcc] text-white shadow-md focus:ring-2 focus:ring-[#0bffffcc]">
    <option value="">همه</option>
    <option value="answered">پاسخ داده شده</option>
    <option value="unanswered">پاسخ داده نشده</option>
  </select>

  <!-- دکمه -->
  <button 
    class="w-full md:w-1/5 px-4 py-2 rounded-xl bg-[#0bffffcc] text-[#062441] font-bold hover:scale-105 transition-transform shadow-lg">
    اعمال فیلتر
  </button>

</form>





<div class="max-w-4xl mx-auto sm:p-4 space-y-4 sm:mx-4">
  {% if question %}               
  <div class="space-y-4">
    {% for i in question %}
    <a href="#" data-id="{{ i.id }}" data-product="{{ i.product.name }}" data-id="{{ i.id }}" data-image-url="{{ i.product.image.url }}" data-text="{{ i.text }}" data-time="{{ i.time }}" data-responsed="{{ i.responsed }}"
      class="block bg-gradient-to-r from-[#0a1f3d] via-[#0b1421] to-[#0a1f3d] rounded-2xl shadow-md p-5 hover:shadow-xl transition border-r-8 border border-[#0bffff66] hover:border-[#0bffffcc] cursor-pointer"
      dir="rtl">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
        <div>
          <h3 class="text-lg font-semibold text-[#ffff]">محصول  : {{ i.product.name }}  </h3>
          <p class="text-sm text-gray-300 mt-1 line-clamp-2">{{ i.time|date:"Y/m/d - H:i" }}</p>
        </div>
      </div>
    </a>

    {% endfor %}
  </div>

   {% else %}
  <div class="text-center text-gray-500 py-10">
    هیچ تیکتی موجود نیست.
  </div>
  {% endif %}
</div>
<div id="modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
  <div class="max-w-3xl w-full bg-[#0b1421] border border-[#0bffffcc] rounded-xl shadow-lg p-6 text-[#ffffff]" dir="rtl" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    
    <button id="modalClose" class="absolute top-4 left-4 text-[#0bffffcc] hover:text-white text-2xl font-bold">&times;</button>
    
    <!-- عنوان -->
    <h2 id="modalTitle" class="text-xl font-extrabold mb-2"><span id="modalProduct" class="text-[#0bffffcc]"></span></h2>
    
    <div class="flex flex-col sm:flex-row sm:items-center gap-4 mb-6">
      <div class="flex-shrink-0 w-32 h-32 rounded-lg overflow-hidden border border-[#0bffffcc]">
        <img id="modalImage" src="" alt="تصویر سوال" class="object-cover w-full h-full" />
      </div>

      <div class="flex-grow">
        <p class="mb-2 text-[#ffffffcc] break-words whitespace-normal">متن پرسش: <span id="modalText" class="font-medium"></span></p>
        <p class="mb-1">وضعیت پاسخ: 
          <span id="modalResponsed" class="font-semibold"></span>
        </p>
        <p class="text-sm text-[#888]" id="modalTime"></p>
      </div>
    </div>

    <hr class="border-[#0bffff99] mb-6" />

    <form method="POST" id="responseForm" enctype="multipart/form-data" class="space-y-4" novalidate>
      {% csrf_token %}
      
      <label for="response_text" class="block mb-2 font-bold text-[#0bffffcc]">متن پاسخ</label>
      <textarea id="response_text" name="response_text" rows="4" required
        class="w-full px-4 py-3 pr-12 rounded-xl border-2 border-[#0bffffcc] bg-[#0b1421] text-white font-bold placeholder-[#b0bfd1] focus:outline-none transition-all duration-500 ease-in-out"></textarea>



      <button type="submit"
        class="w-full bg-[#0bffffcc] hover:bg-[#0bffffee] text-[#0b1421] font-extrabold py-3 rounded-lg transition shadow-md hover:shadow-lg">
        ارسال پاسخ
      </button>
    </form>
  </div>
</div>



 



<script>
const modal = document.getElementById('modal');
const modalCloseBtn = document.getElementById('modalClose');
const responseForm = document.getElementById('responseForm');
const modalProduct = document.getElementById('modalProduct');
const modalText = document.getElementById('modalText');
const modalImage = document.getElementById('modalImage');
const modalTime = document.getElementById('modalTime');
const modalResponsed = document.getElementById('modalResponsed');

document.querySelectorAll('a[data-id]').forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();

    // پر کردن اطلاعات مودال
    modalProduct.textContent = this.dataset.product;
    modalText.textContent = this.dataset.text;
    modalImage.src = this.dataset.imageUrl || '/static/default-image.png';
    modalTime.textContent = `زمان ثبت: ${new Date(this.dataset.time).toLocaleString('fa-IR')}`;
    
    if(this.dataset.responsed === 'True' || this.dataset.responsed === 'true'){
      modalResponsed.innerHTML = '<span class="text-green-400"><i class="bi bi-check2-circle"></i> پاسخ داده شده</span>';
    } else {
      modalResponsed.innerHTML = '<span class="text-red-400"><i class="bi bi-x-circle"></i> بدون پاسخ</span>';
    }

    // بروز رسانی اکشن فرم با data-id
    const id = this.dataset.id;
    const shopId = '{{ shop_id }}';
    responseForm.action = `/shop/shop_questions/${shopId}/reponse_to_question/${id}/`;
    
    modal.classList.remove('hidden');
  });
});

// بستن مودال
modalCloseBtn.addEventListener('click', () => {
  modal.classList.add('hidden');
});

// بستن مودال با کلیک بیرون فرم
modal.addEventListener('click', e => {
  if(e.target === modal) {
    modal.classList.add('hidden');
  }
});

</script>
 
{% endblock %}