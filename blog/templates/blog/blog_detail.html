{% extends 'blog/base.html' %}
{% block blog_con %} 

<title>
    {% if site_info.site_title %} {{ site_info.site_title }} {% else %}Alastra{% endif %} | {{ article.title|truncatechars:40 }}
</title>

<head>
    <meta name="title" content="{{ post.title }} - {{ post.author.name }} | Blog Title" />
    <meta name="description" content="{{ post.short_des }}" />
    <meta name="keywords" content="{{ post.category.name|default:'General' }}, {{ post.title }}, Blog, Article" />
    <meta name="author" content="{{ post.author.name }}" />

    <meta property="og:title" content="{{ post.title }}" />
    <meta property="og:description" content="{{ post.short_des }}" />
    <meta property="og:image" content="{{ post.image.url|default:'default-image-url.jpg' }}" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="{{ request.build_absolute_uri }}" />

    <meta name="twitter:title" content="{{ post.title }}" />
    <meta name="twitter:description" content="{{ post.short_des }}" />
    <meta name="twitter:image" content="{{ post.image.url|default:'default-image-url.jpg' }}" />
    <meta name="twitter:card" content="summary_large_image" />
    
    <link rel="canonical" href="{{ request.build_absolute_uri }}" />
</head>





<div class="min-h-screen bg-gradient-to-br from-[#0f1a2d] via-[#0b1421] to-[#07101d]">

    <div class="border-b border-[#0bffff33] bg-gradient-to-b from-[#0b1421] to-[#0a1828]">
        <div class="max-w-6xl mx-auto px-4 py-8">
            <!-- مسیر ناوبری -->
            <div class="flex items-center gap-2 text-sm text-[#0bffffaa] mb-6">
                <a href="#" class="hover:text-[#0bffff] transition-colors">خانه</a>
                <i class="bi bi-chevron-left text-xs"></i>
                <a href="#" class="hover:text-[#0bffff] transition-colors">{{ article.category.name }}</a>
                <i class="bi bi-chevron-left text-xs"></i>
                <span class="text-white">{{ article.title|truncatechars:40 }}</span>
            </div>

            <!-- عنوان اصلی -->
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-black text-white leading-tight mb-6 text-justify">
                {{ article.title }}
            </h1>

            <div class="flex flex-wrap items-center gap-6 text-[#0bffffaa] text-sm mb-6">
                <div class="flex items-center gap-2">
                    <i class="bi bi-person-circle text-[#0bffff]"></i>
                    <span class="text-white font-medium">{{ article.author.full_name }}</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="bi bi-calendar text-[#0bffff]"></i>
                    <span>{{ article.created|date:"d F Y" }}</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="bi bi-clock text-[#0bffff]"></i>
                    <span>{{ article.time_red }} دقیقه</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="bi bi-eye text-[#0bffff]"></i>
                    <span>{{ article.views }} بازدید</span>
                </div>
            </div>

            <!-- تگ‌ها -->
            <div class="flex items-center gap-3 flex-wrap">
                {% for tag in category %}
                <span class="bg-[#0bffff22] border border-[#0bffff33] text-[#0bffff] px-3 py-1 rounded-full text-xs font-bold hover:bg-[#0bffff33] transition-colors cursor-pointer">
                    <a href="{% url 'blog:filter_blogs' tag.id %}">#{{ tag.name }}</a>
                </span>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- محتوای اصلی -->
    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-8">
                <!-- تصویر شاخص -->
                <div class="mb-8 rounded-2xl overflow-hidden border border-[#0bffff33] shadow-2xl">
                    <img src="{{ article.image.url }}" 
                         class="w-full h-96 object-cover"
                         loading="lazy"
                         alt="{{ article.title }}">
                </div>

                <div class="bg-gradient-to-r from-[#0bffff11] to-transparent border-r-4 border-[#0bffff] p-6 rounded-lg mb-8">
                    <p class="text-xl text-white leading-8 text-justify font-medium">
                        {{ article.short_des }}
                    </p>
                </div>

                <!-- بخش‌های محتوا -->
                <div class="space-y-8">
                    {% for section in contents %}
                    <div id="section-{{ section.id }}" class="scroll-mt-24">
                        <!-- عنوان بخش -->
                        <h2 class="text-2xl font-black text-white mb-6 pb-3 border-b border-[#0bffff33]">
                            {{ section.title }}
                        </h2>
                        
                        <!-- تصویر بخش -->
                        {% if section.image %}
                        <div class="my-6 rounded-xl overflow-hidden border border-[#0bffff33]">
                            <img src="{{ section.image.url }}" 
                                 class="w-full h-64 object-cover"
                                 loading="lazy"
                                 alt="{{ section.title }}">
                        </div>
                        {% endif %}
                        
                        <!-- محتوای بخش -->
                        <div class="text-white leading-8 text-justify text-lg space-y-4">
                            {{ section.content|linebreaks }}
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- دکمه‌های اشتراک‌گذاری -->
                <div class="mt-12 p-6 bg-gradient-to-br from-[#06244188] to-[#0b142188] rounded-2xl border border-[#0bffff33]">
                    <div class="flex items-center justify-between">
                        <span class="text-white font-bold">این مطلب را با دوستان خود به اشتراک بگذارید:</span>
                        <div class="flex items-center gap-3">
                            <button onclick="shareProduct()" class="w-10 h-10 bg-[#0088cc] rounded-full flex items-center justify-center text-white hover:scale-110 transition-transform">
                                <i class="bi bi-telegram"></i>
                            </button>
                            <button onclick="shareProduct()" class="w-10 h-10 bg-[#25d366] rounded-full flex items-center justify-center text-white hover:scale-110 transition-transform">
                                <i class="bi bi-whatsapp"></i>
                            </button>
                            <button onclick="shareProduct()" class="w-10 h-10 bg-[#1da1f2] rounded-full flex items-center justify-center text-white hover:scale-110 transition-transform">
                                <i class="bi bi-twitter"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- سایدبار ثابت -->
            <div class="lg:col-span-4">
                <div class="sticky top-6 space-y-6"> <!-- اضافه کردن sticky و top -->
                    <!-- نویسنده -->
                    <div class="bg-gradient-to-br from-[#06244188] to-[#0b142188] rounded-2xl p-6 border border-[#0bffff33]">
                        <div class="text-center">
                            <img src="{% if article.author.profile %}{{ article.author.profile.url }}{% endif %}" 
                                 class="w-20 h-20 rounded-2xl border-2 border-[#0bffff33] mx-auto mb-4">
                            <h4 class="text-lg font-black text-white">{{ article.author.full_name }}</h4>
                            <div class="flex items-center justify-center gap-4 mt-4 text-[#0bffffaa] text-sm">
                                <span>{{ article.author.count_posts }} وبلاگ</span>
                                <span>•</span>
                            </div>
                            <button class="w-full mt-4 py-2 bg-gradient-to-r from-[#0bffff33] to-[#0bffff11] border border-[#0bffff44] text-[#0bffff] rounded-lg hover:border-[#0bffff] transition-all duration-300 font-medium">
                                دنبال کردن
                            </button>
                        </div>
                    </div>

                    <!-- فهرست مطالب -->
                    <div class="bg-gradient-to-br from-[#06244188] to-[#0b142188] rounded-2xl p-6 border border-[#0bffff33]">
                        <h3 class="text-lg font-black text-white mb-4 flex items-center gap-2">
                            <i class="bi bi-list-ul text-[#0bffff]"></i>
                            فهرست مطالب
                        </h3>
                        <div class="space-y-2">
                            {% for section in contents %}
                            <a href="#section-{{ section.id }}" 
                               class="flex items-center gap-3 p-3 rounded-lg bg-[#0b142133] hover:bg-[#0bffff11] text-white transition-all duration-300 group">
                                <span class="w-6 h-6 bg-[#0bffff33] rounded-full flex items-center justify-center text-[#0bffff] text-xs font-bold group-hover:bg-[#0bffff] group-hover:text-[#062441] transition-all">
                                    {{ forloop.counter }}
                                </span>
                                <span class="text-sm flex-1">{{ section.title }}</span>
                                <i class="bi bi-arrow-left text-[#0bffffaa] group-hover:text-[#0bffff] transition-colors"></i>
                            </a>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- پرطرفدارترین‌ها -->
                    <div class="bg-gradient-to-br from-[#06244188] to-[#0b142188] rounded-2xl p-6 border border-[#0bffff33]">
                        <h3 class="text-lg font-black text-white mb-4 flex items-center gap-2">
                            <i class="bi bi-fire text-[#0bffff]"></i>
                            داغ‌ترین مطالب
                        </h3>
                        <div class="space-y-4">
                            {% for popular in popular_articles %}
                            <a href="{% url 'blog:blog_detail' popular.id %}" class="flex items-center gap-3 group">
                                <img src="{{ popular.image.url }}" loading="lazy"
                                alt="{{ popular.title }}"
                                     class="w-16 h-16 rounded-lg object-cover border border-[#0bffff33] group-hover:border-[#0bffff] transition-colors">
                                <div class="flex-1">
                                    <h4 class="text-sm font-bold text-white group-hover:text-[#0bffff] transition-colors line-clamp-2">
                                        {{ popular.title }}
                                    </h4>
                                    <div class="flex items-center gap-2 mt-1 text-[#0bffffaa] text-xs">
                                        <span>{{ popular.created|date:"m/d" }}</span>
                                        <span>•</span>
                                        <span>{{ popular.views }} بازدید</span>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-16">
            <h3 class="text-2xl font-black text-white mb-8 pb-3 border-b border-[#0bffff33] flex items-center gap-2">
                <i class="bi bi-link-45deg text-[#0bffff]"></i>
                مطالب مرتبط
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for related in contents %}
                <a href="#" class="group bg-gradient-to-br from-[#06244188] to-[#0b142188] rounded-2xl overflow-hidden border border-[#0bffff33] hover:border-[#0bffff] hover:shadow-[0_0_30px_rgba(11,255,255,0.2)] transition-all duration-500">
                    <div class="h-48 overflow-hidden">
                      {% if related.image %}
                        <img src="{{ related.image.url }}" 
                             class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                             alt="{{ related.title }}" loading="lazy">
                      {% endif %}
                    </div>
                    <div class="p-4">
                        <h4 class="text-lg font-black text-white group-hover:text-[#0bffff] transition-colors line-clamp-2 mb-2">
                            {{ related.title }}
                        </h4>
                        <div class="flex items-center justify-between text-[#0bffffaa] text-sm">
                            <span>{{ related.created_at|date:"Y/m/d" }}</span>
                            <span>{{ related.time_read }} دقیقه</span>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
.scroll-mt-24 {
    scroll-margin-top: 6rem;
}

/* برای اطمینان از عملکرد صحیح sticky */
.sticky {
    align-self: flex-start;
}
</style>


<script>
  function shareProduct() {
    if (navigator.share) {
      navigator.share({
        title: document.title,
        url: window.location.href
      });
    } else {
      alert('مرورگر شما از اشتراک‌گذاری پشتیبانی نمی‌کند.');
    }
  }
</script>

{% endblock %}